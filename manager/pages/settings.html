<!doctype html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../styles/main.css">
	<link rel="stylesheet" href="../styles/settings.css">
	<title>Settings - Electronic</title>
	<style>
		.sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border: 0;
		}
		
		input[type="range"] {
			background: rgba(128, 128, 128, 0.2);
			border-radius: 4px;
			height: 6px;
		}
		
		.setting-item {
			margin-bottom: 10px;
		}
		
		.setting-item > div {
			margin-bottom: 5px;
		}

		#preferences-panel .setting-item {
			flex-direction: row;
			align-items: center;
			margin-bottom: 10px;
			gap: 10px;
		}
		
		#preferences-panel .setting-item .setting-label {
			flex: 0 0 120px;
			width: auto;
			margin-bottom: 0;
		}
		
		#preferences-panel .setting-item > div {
			width: auto;
			margin-bottom: 0;
		}
		
		.setting-slider {
			display: flex;
			align-items: center;
			gap: 10px;
		}
		
		.slider-value input[type="number"] {
			width: 60px;
			padding: 5px;
			border: 1px solid var(--border-color);
			border-radius: 4px;
			text-align: center;
			vertical-align: middle;
		}
	</style>
</head>
<body class="page-fade-in">
	<div class="nav" id="nav">
		<img src="../res/Electronic Logo.png" alt="Electronic Logo" class="logo" onclick="toNewWindow('http:/8.138.227.135')">
		<div class="nav-buttons">
			<button type="button" class="nav-btn" data-text="Basic Info" data-href="./main.html" data-theme-action="restore">âšª<span>Basic</span></button>
			<button type="button" class="nav-btn" data-text="Accounts" data-href="./accounts.html" data-theme-action="restore">ğŸ‘¥<span>Accounts</span></button>
			<button type="button" class="nav-btn active" data-text="Settings" data-href="./settings.html" data-theme-action="save">âš™ï¸<span>Settings</span></button>
		</div>
		<button type="button" class="toggle-nav" id="toggleNav">å±•å¼€</button>
	</div>

	<div class="labels" id="labels">
		<button class="labelsButton active" data-category="appearance" type="button">å¤–è§‚</button>
		<button class="labelsButton" data-category="preferences" type="button">åå¥½</button>
	</div>

	<div class="content-panel" id="appearance-panel">
		<h2>å¤–è§‚è®¾ç½®</h2>
		<div class="setting-item">
			<div class="setting-label">ä¸»é¢˜</div>
			<div class="radio-group">
				<label><input type="radio" name="theme" value="theme-light"> æµ…è‰²</label>
				<label><input type="radio" name="theme" value="theme-dark"> æš—è‰²</label>
				<label><input type="radio" name="theme" value="theme-high-contrast"> é«˜å¯¹æ¯”</label>
			</div>
		</div>

		<div class="setting-item">
			<div class="setting-label">ç•Œé¢é£æ ¼</div>
			<div class="radio-group">
				<label><input type="radio" name="uiStyle" value="ui-modern"> ç°ä»£</label>
				<label><input type="radio" name="uiStyle" value="ui-classic"> ç»å…¸</label>
			</div>
		</div>

		<div class="setting-item">
			<div class="setting-label">å­—ä½“å¤§å°</div>
			<div class="setting-slider">
				<input id="fontSizeRange" type="range" min="12" max="22" step="1" value="16" aria-labelledby="fontSizeRangeLabel">
				<label for="fontSizeRange" id="fontSizeRangeLabel" class="sr-only">å­—ä½“å¤§å°æ»‘å—</label>
			</div>
			<div class="slider-value">
				<label for="fontSizeValue" class="sr-only">å­—ä½“å¤§å°æ•°å€¼</label>
				<input id="fontSizeValue" type="number" min="12" max="22" value="16">
			</div>
		</div>

		<div class="setting-item">
			<div class="setting-label">åŠ¨ç”»æ—¶é•¿ (ms)</div>
			<div class="setting-slider">
				<input id="animRange" type="range" min="50" max="2000" step="10" value="350" aria-labelledby="animRangeLabel">
				<label for="animRange" id="animRangeLabel" class="sr-only">åŠ¨ç”»æ—¶é•¿æ»‘å—</label>
			</div>
			<div class="slider-value">
				<label for="animValue" class="sr-only">åŠ¨ç”»æ—¶é•¿æ•°å€¼</label>
				<input id="animValue" type="number" min="50" max="2000" step="10" value="350">
			</div>
		</div>
	</div>

	<div class="content-panel" id="preferences-panel">
		<h2>åå¥½</h2>
		<div class="setting-item">
			<div class="setting-label">é€šçŸ¥</div>
			<label>
				<input id="notifEnabled" type="checkbox" />
				<span>å¯ç”¨é€šçŸ¥</span>
			</label>
		</div>

		<div class="setting-item">
			<div class="setting-label">éŸ³é‡</div>
			<div class="setting-slider">
				<input id="notifVolumeRange" type="range" min="0" max="100" step="1" value="80" aria-labelledby="notifVolumeRangeLabel">
				<label for="notifVolumeRange" id="notifVolumeRangeLabel" class="sr-only">é€šçŸ¥éŸ³é‡æ»‘å—</label>
			</div>
			<div class="slider-value">
				<label for="notifVolumeValue" class="sr-only">é€šçŸ¥éŸ³é‡æ•°å€¼</label>
				<input id="notifVolumeValue" type="number" min="0" max="100" step="1" value="80">
			</div>
		</div>

		<div class="setting-item">
			<label id="soundStyleLabel" class="setting-label">éŸ³æ•ˆé£æ ¼</label>
			<select id="notifSoundStyle" aria-labelledby="soundStyleLabel" data-custom>
				<option value="default">default</option>
				<option value="electronic">electronic</option>
				<option value="natural">natural</option>
				<option value="soft">soft</option>
			</select>
		</div>
		
		<!-- è°ƒè¯•ç•Œé¢å…¥å£ -->
		<div class="setting-item debug-tools">
			<div class="setting-label">è°ƒè¯•å·¥å…·</div>
			<div>
				<a href="../pages/test.html" target="_blank" class="debug-btn">ç»¼åˆæµ‹è¯•é¡µé¢</a>
			</div>
		</div>
	</div>

	<!-- å›ºå®šåœ¨é¡µé¢åº•éƒ¨çš„ä¿å­˜æŒ‰é’® -->
	<div class="fixed-save-bar">
		<div class="action-buttons">
			<button id="save-settings" class="settings-btn" disabled>ä¿å­˜è®¾ç½®</button>
			<button id="reset-settings" class="settings-btn">æ¢å¤é»˜è®¤</button>
		</div>
	</div>

	<div id="notificationContainer" class="notification-container"></div>
	<script>
		function toOriWindow(href) {
			if (typeof navigateWithFade === 'function') return navigateWithFade(href, 'restore');
			window.location.href = href;
		}
		function toNewWindow(href) {
			try { window.open(href, '_blank', 'noopener'); } catch(e) { window.location.href = href; }
		}
		function saveCurrentTheme() {
			try {
				const obj = {
					htmlClass: document.documentElement.className || '',
					uiStyle: document.documentElement.classList.contains('ui-modern') ? 'ui-modern' : document.documentElement.classList.contains('ui-classic') ? 'ui-classic' : '',
					fontSize: getComputedStyle(document.documentElement).getPropertyValue('--font-size') || '16px'
				};
				localStorage.setItem('savedTheme', JSON.stringify(obj));
			} catch(e){}
		}
		function restoreOriginalTheme() {
			try {
				const raw = localStorage.getItem('savedTheme');
				if (!raw) { return; }
				const obj = JSON.parse(raw);
				if (obj.htmlClass) document.documentElement.className = obj.htmlClass;
				if (obj.fontSize) document.documentElement.style.setProperty('--font-size', obj.fontSize);
			} catch(e){}
		}
		function showNotification(msg, type){
			// ä¼˜å…ˆä½¿ç”¨æ–°çš„é€šçŸ¥ç³»ç»Ÿï¼Œç¡®ä¿æ ·å¼ä¸€è‡´æ€§
			if (typeof window.showInfoNotification === 'function') {
				const titles = { error:'é”™è¯¯', warning:'è­¦å‘Š', info:'ä¿¡æ¯', success:'æˆåŠŸ' };
				const title = titles[type] || 'ä¿¡æ¯';
				window.showInfoNotification(title, msg);
			} else if (typeof createNotification === 'function') {
				createNotification(type, 'ä¿¡æ¯', msg);
			} else {
				console.warn('é€šçŸ¥ç³»ç»Ÿä¸å¯ç”¨');
			}
		}
		function hideError(){ const e=document.getElementById('error'); e && e.classList.remove('show'); }
		function hideWarning(){ const e=document.getElementById('warning'); e && e.classList.remove('show'); }
		function hideInfo(){ const e=document.getElementById('info'); e && e.classList.remove('show'); }
		
		// å¯ç”¨ä¿å­˜æŒ‰é’®çš„å‡½æ•°
		function enableSaveButton() {
			const saveButton = document.getElementById('save-settings');
			if (saveButton) {
				saveButton.disabled = false;
			}
		}
		
		// ä¿å­˜åˆå§‹è®¾ç½®çŠ¶æ€çš„å‡½æ•°
		function saveInitialSettings() {
			const themeRadios = document.querySelectorAll('input[name="theme"]:checked');
			const uiRadios = document.querySelectorAll('input[name="uiStyle"]:checked');
			const fontRange = document.getElementById('fontSizeRange');
			const animRange = document.getElementById('animRange');
			const notifEnabled = document.getElementById('notifEnabled');
			const notifRange = document.getElementById('notifVolumeRange');
			const soundStyleSel = document.getElementById('notifSoundStyle');
			
			window.initialSettings = {
				theme: themeRadios.length > 0 ? themeRadios[0].value : 'theme-light',
				uiStyle: uiRadios.length > 0 ? uiRadios[0].value : 'ui-modern',
				fontSize: fontRange ? fontRange.value : '16',
				animSpeed: animRange ? animRange.value : '350',
				notifEnabled: notifEnabled ? notifEnabled.checked : true,
				notifVolume: notifRange ? notifRange.value : '80',
				soundStyle: soundStyleSel ? soundStyleSel.value : 'default'
			};
		}
		
		// æ£€æŸ¥è®¾ç½®æ˜¯å¦å‘ç”Ÿå˜åŒ–çš„å‡½æ•°
		function checkSettingsChanged() {
			const themeRadios = document.querySelectorAll('input[name="theme"]:checked');
			const uiRadios = document.querySelectorAll('input[name="uiStyle"]:checked');
			const fontRange = document.getElementById('fontSizeRange');
			const animRange = document.getElementById('animRange');
			const notifEnabled = document.getElementById('notifEnabled');
			const notifRange = document.getElementById('notifVolumeRange');
			const soundStyleSel = document.getElementById('notifSoundStyle');
			
			const currentSettings = {
				theme: themeRadios.length > 0 ? themeRadios[0].value : 'theme-light',
				uiStyle: uiRadios.length > 0 ? uiRadios[0].value : 'ui-modern',
				fontSize: fontRange ? fontRange.value : '16',
				animSpeed: animRange ? animRange.value : '350',
				notifEnabled: notifEnabled ? notifEnabled.checked : true,
				notifVolume: notifRange ? notifRange.value : '80',
				soundStyle: soundStyleSel ? soundStyleSel.value : 'default'
			};
			
			// æ¯”è¾ƒå½“å‰è®¾ç½®ä¸åˆå§‹è®¾ç½®
			const isChanged = JSON.stringify(currentSettings) !== JSON.stringify(window.initialSettings);
			
			const saveButton = document.getElementById('save-settings');
			if (saveButton) {
				saveButton.disabled = !isChanged;
			}
			
			return isChanged;
		}
	</script>

	<script src="../scripts/base.js"></script>
	<script src="../scripts/settings-global.js"></script>
	<script src="../scripts/custom-select.js"></script>

	<!-- é¡µé¢å†…äº¤äº’ï¼šä¸»é¢˜ã€UIã€å­—ä½“ã€åŠ¨ç”»æ§åˆ¶ï¼ˆä¸ main.js å…±å­˜ï¼‰ -->
	<script>
		document.addEventListener('DOMContentLoaded', function(){
			// åŒæ­¥æ§ä»¶ä¸å½“å‰çŠ¶æ€ / æœ¬åœ°ä¿å­˜å€¼
			const themeRadios = document.querySelectorAll('input[name="theme"]');
			const uiRadios = document.querySelectorAll('input[name="uiStyle"]');
			const fontRange = document.getElementById('fontSizeRange');
			const fontValue = document.getElementById('fontSizeValue');
			const animRange = document.getElementById('animRange');
			const animValue = document.getElementById('animValue');

			// åˆå§‹åŒ–ï¼šä» documentElement æˆ– localStorage è¯»å–
			const saved = localStorage.getItem('savedTheme');
			if (saved) {
				try {
					const obj = JSON.parse(saved);
					if (obj.htmlClass) document.documentElement.className = obj.htmlClass;
					if (obj.fontSize) {
						document.documentElement.style.setProperty('--font-size', obj.fontSize);
					}
				} catch(e) {
					console.error('è¯»å–å·²ä¿å­˜ä¸»é¢˜æ—¶å‡ºé”™ï¼š', e);
				}
			}

			// è®¾ç½® theme æ§ä»¶çŠ¶æ€
			const cls = document.documentElement.className || '';
			themeRadios.forEach(r=>{
				r.checked = cls.includes(r.value);
			});
			uiRadios.forEach(r=> r.checked = cls.includes(r.value));

			// å­—ä½“
			const curFont = getComputedStyle(document.documentElement).getPropertyValue('--font-size') || '16px';
			const curFontNum = parseInt(curFont,10) || 16;
			fontRange.value = curFontNum;
			fontValue.value = curFontNum;

			// åŠ¨ç”»æ—¶é•¿
			let animSaved = localStorage.getItem('animationSpeed');
			if (animSaved && /^\d+$/.test(animSaved.trim())) animSaved = parseInt(animSaved,10);
			else animSaved = 350;
			animRange.value = animSaved;
			animValue.value = animSaved;

			// --- é€šçŸ¥è®¾ç½®ï¼šåˆå§‹åŒ–ä¸ç»‘å®š ---
			const notifEnabled = document.getElementById('notifEnabled');
			const notifRange = document.getElementById('notifVolumeRange');
			const notifValue = document.getElementById('notifVolumeValue');
			const soundStyleSel = document.getElementById('notifSoundStyle');

			// è¯»å–æœ¬åœ°è®¾ç½®ï¼ˆé»˜è®¤å¯ç”¨ï¼ŒéŸ³é‡80ï¼‰
			let enabled = localStorage.getItem('notificationsEnabled');
			enabled = (enabled === null) ? true : (enabled === 'true');
			let vol = localStorage.getItem('notificationVolume');
			vol = (vol === null) ? 0.8 : Math.min(1, Math.max(0, parseFloat(vol)));

			notifEnabled.checked = !!enabled;
			notifRange.value = Math.round(vol * 100);
			notifValue.value = Math.round(vol * 100);

			// éŸ³æ•ˆé£æ ¼æ§ä»¶åˆå§‹åŒ–ä¸ç»‘å®š
			let savedStyle = localStorage.getItem('notificationSoundStyle') || 'default';
			soundStyleSel.value = savedStyle;

			// åº”ç”¨åˆ°ä¸»è„šæœ¬ï¼ˆè‹¥å­˜åœ¨ï¼‰
			if (typeof window.setSoundStyle === 'function') {
				window.setSoundStyle(savedStyle);
			}

			// --- é€šçŸ¥ç»‘å®š ---
			notifRange.addEventListener('input', function(){
				notifValue.value = this.value;
				const v = Math.round(Number(this.value))/100;
				localStorage.setItem('notificationVolume', String(v));
				if (typeof window.setNotificationVolume === 'function') window.setNotificationVolume(v);
				// å¯ç”¨ä¿å­˜æŒ‰é’®
				enableSaveButton();
				// å®æ—¶åº”ç”¨è®¾ç½®
				checkSettingsChanged();
			});
			
			notifValue.addEventListener('change', function(){
				let v = Math.round(Math.max(0, Math.min(100, Number(this.value)||0)));
				this.value = v;
				notifRange.value = v;
				const vv = v/100;
				localStorage.setItem('notificationVolume', String(vv));
				if (typeof window.setNotificationVolume === 'function') window.setNotificationVolume(vv);
				// å¯ç”¨ä¿å­˜æŒ‰é’®
				enableSaveButton();
				// å®æ—¶åº”ç”¨è®¾ç½®
				checkSettingsChanged();
			});

			notifEnabled.addEventListener('change', function(){
				const on = !!this.checked;
				localStorage.setItem('notificationsEnabled', on ? 'true' : 'false');
				if (typeof window.setNotificationsEnabled === 'function') window.setNotificationsEnabled(on);
				// å¯ç”¨ä¿å­˜æŒ‰é’®
				enableSaveButton();
				// å®æ—¶åº”ç”¨è®¾ç½®
				checkSettingsChanged();
			});

			soundStyleSel.addEventListener('change', function(){
				const style = this.value || 'default';
				localStorage.setItem('notificationSoundStyle', style);
				if (typeof window.setSoundStyle === 'function') {
					window.setSoundStyle(style);
				}
				// å¯ç”¨ä¿å­˜æŒ‰é’®
				enableSaveButton();
				// å®æ—¶åº”ç”¨è®¾ç½®
				checkSettingsChanged();
                // æµ‹è¯•éŸ³æ•ˆæ˜¯å¦ç”Ÿæ•ˆ
                const enabled = localStorage.getItem('notificationsEnabled') !== 'false';
                if (enabled && typeof window.playSoundForLevel === 'function') {
                    window.playSoundForLevel('info');
                }
			});
			// --- end é€šçŸ¥ç»‘å®š ---

			// ç»‘å®šäº‹ä»¶
			themeRadios.forEach(r=>{
				r.addEventListener('change', ()=> {
					// ç§»é™¤å…¶å®ƒä¸»é¢˜ç±»ï¼Œæ·»åŠ é€‰ä¸­
					document.documentElement.classList.remove('theme-light','theme-dark','theme-high-contrast');
					document.documentElement.classList.add(r.value);
					// å®æ—¶åº”ç”¨è®¾ç½®
					checkSettingsChanged();
					// å¯ç”¨ä¿å­˜æŒ‰é’®
					enableSaveButton();
				});
			});
			
			uiRadios.forEach(r=>{
				r.addEventListener('change', ()=> {
					document.documentElement.classList.toggle('ui-modern', r.value === 'ui-modern');
					document.documentElement.classList.toggle('ui-classic', r.value === 'ui-classic');
					// å®æ—¶åº”ç”¨è®¾ç½®
					checkSettingsChanged();
					// å¯ç”¨ä¿å­˜æŒ‰é’®
					enableSaveButton();
				});
			});
			
			fontRange.addEventListener('input', ()=> { 
				fontValue.value = fontRange.value; 
				applyFont(fontRange.value);
				// å®æ—¶åº”ç”¨è®¾ç½®
				checkSettingsChanged();
				// å¯ç”¨ä¿å­˜æŒ‰é’®
				enableSaveButton();
			});
			
			fontValue.addEventListener('change', ()=> { 
				let v = Math.max(12, Math.min(22, Number(fontValue.value)||16)); 
				fontRange.value = v; 
				fontValue.value = v; 
				applyFont(v);
				// å®æ—¶åº”ç”¨è®¾ç½®
				checkSettingsChanged();
				// å¯ç”¨ä¿å­˜æŒ‰é’®
				enableSaveButton();
			});

			animRange.addEventListener('input', ()=> { 
				animValue.value = animRange.value; 
				applyAnim(animRange.value);
				// å®æ—¶åº”ç”¨è®¾ç½®
				checkSettingsChanged();
				// å¯ç”¨ä¿å­˜æŒ‰é’®
				enableSaveButton();
			});
			
			animValue.addEventListener('change', ()=> { 
				let v = Math.max(50, Math.min(2000, Number(animValue.value)||350)); 
				animRange.value = v; 
				animValue.value = v; 
				applyAnim(v);
				// å®æ—¶åº”ç”¨è®¾ç½®
				checkSettingsChanged();
				// å¯ç”¨ä¿å­˜æŒ‰é’®
				enableSaveButton();
			});

			document.getElementById('save-settings').addEventListener('click', ()=> {
				const saveButton = document.getElementById('save-settings');
				
				// ä¿å­˜ theme ä¸åå¥½
				const obj = {
					htmlClass: document.documentElement.className || '',
					fontSize: getComputedStyle(document.documentElement).getPropertyValue('--font-size') || '16px'
				};
				localStorage.setItem('savedTheme', JSON.stringify(obj));
				localStorage.setItem('animationSpeed', String(animValue.value));
				
				// ä¿å­˜å½“å‰è®¾ç½®ä¸ºæ–°çš„åˆå§‹çŠ¶æ€
				saveInitialSettings();
				
				// ç¦ç”¨ä¿å­˜æŒ‰é’®
				saveButton.disabled = true;
				
				// ä½¿ç”¨å…¨å±€é€šçŸ¥ç³»ç»Ÿæ˜¾ç¤ºå¸¦æ ‡é¢˜å’ŒéŸ³æ•ˆçš„æˆåŠŸé€šçŸ¥
				if (typeof window.showSuccessNotification === 'function') {
					window.showSuccessNotification('è®¾ç½®ä¿å­˜æˆåŠŸ', 'æ‚¨çš„è®¾ç½®å·²æˆåŠŸä¿å­˜');
				} else if (typeof createNotification === 'function') {
					createNotification('success', 'è®¾ç½®ä¿å­˜æˆåŠŸ', 'æ‚¨çš„è®¾ç½®å·²æˆåŠŸä¿å­˜');
				} else {
					console.warn('é€šçŸ¥ç³»ç»Ÿä¸å¯ç”¨');
				}
			});
			
			document.getElementById('reset-settings').addEventListener('click', ()=> {
				// é‡ç½®å¤–è§‚è®¾ç½®
				const themeRadios = document.querySelectorAll('input[name="theme"]');
				const uiRadios = document.querySelectorAll('input[name="uiStyle"]');
				const fontRange = document.getElementById('fontSizeRange');
				const fontValue = document.getElementById('fontSizeValue');
				const animRange = document.getElementById('animRange');
				const animValue = document.getElementById('animValue');
				
				// é‡ç½®ä¸»é¢˜ä¸ºé»˜è®¤ï¼ˆæµ…è‰²ä¸»é¢˜ï¼‰
				themeRadios.forEach(radio => {
					if (radio.value === 'theme-light') {
						radio.checked = true;
						document.documentElement.classList.remove('theme-dark', 'theme-high-contrast');
						document.documentElement.classList.add('theme-light');
					} else {
						radio.checked = false;
					}
				});
				
				// é‡ç½®UIé£æ ¼ä¸ºé»˜è®¤ï¼ˆç°ä»£é£æ ¼ï¼‰
				uiRadios.forEach(radio => {
					if (radio.value === 'ui-modern') {
						radio.checked = true;
						document.documentElement.classList.add('ui-modern');
						document.documentElement.classList.remove('ui-classic');
					} else {
						radio.checked = false;
					}
				});
				
				// é‡ç½®å­—ä½“å¤§å°
				fontRange.value = 16;
				fontValue.value = 16;
				applyFont(16);
				
				// é‡ç½®åŠ¨ç”»æ—¶é•¿
				animRange.value = 350;
				animValue.value = 350;
				applyAnim(350);
				
				// é‡ç½®åå¥½è®¾ç½®
				const notifEnabled = document.getElementById('notifEnabled');
				const notifRange = document.getElementById('notifVolumeRange');
				const notifValue = document.getElementById('notifVolumeValue');
				const soundStyleSel = document.getElementById('notifSoundStyle');
				
				// é‡ç½®é€šçŸ¥è®¾ç½®ä¸ºé»˜è®¤å€¼
				notifEnabled.checked = true;
				notifRange.value = 80;
				notifValue.value = 80;
				soundStyleSel.value = 'default';
				
				// æ›´æ–°localStorageä¸­çš„é€šçŸ¥è®¾ç½®
				localStorage.setItem('notificationsEnabled', 'true');
				localStorage.setItem('notificationVolume', '0.8');
				localStorage.setItem('notificationSoundStyle', 'default');
				
				// è°ƒç”¨ç›¸å…³å‡½æ•°æ›´æ–°é€šçŸ¥è®¾ç½®
				if (typeof window.setNotificationsEnabled === 'function') {
					window.setNotificationsEnabled(true);
				}
				if (typeof window.setNotificationVolume === 'function') {
					window.setNotificationVolume(0.8);
				}
				if (typeof window.setSoundStyle === 'function') {
					window.setSoundStyle('default');
				}
				
				// ä¿å­˜å½“å‰è®¾ç½®ä¸ºæ–°çš„åˆå§‹çŠ¶æ€
				saveInitialSettings();
				
				// ç¦ç”¨ä¿å­˜æŒ‰é’®ï¼ˆå› ä¸ºè®¾ç½®å·²é‡ç½®ä¸ºé»˜è®¤å€¼ï¼‰
				const saveButton = document.getElementById('save-settings');
				saveButton.disabled = true;
				
				// ç»Ÿä¸€ä½¿ç”¨æ–°çš„é€šçŸ¥ç³»ç»Ÿ
				if (typeof window.showInfoNotification === 'function') {
					window.showInfoNotification('è®¾ç½®é‡ç½®', 'å·²æ¢å¤é»˜è®¤è®¾ç½®');
				} else if (typeof createNotification === 'function') {
					createNotification('info', 'è®¾ç½®é‡ç½®', 'å·²æ¢å¤é»˜è®¤è®¾ç½®');
				} else {
					console.warn('é€šçŸ¥ç³»ç»Ÿä¸å¯ç”¨');
				}
			});

			// é¡µé¢åŠ è½½å®Œæˆåä¿å­˜åˆå§‹è®¾ç½®çŠ¶æ€
			window.addEventListener('DOMContentLoaded', () => {
				// å»¶è¿Ÿä¸€ç‚¹æ‰§è¡Œï¼Œç¡®ä¿æ‰€æœ‰è®¾ç½®éƒ½å·²åˆå§‹åŒ–
				setTimeout(() => {
					saveInitialSettings();
					// åˆå§‹çŠ¶æ€ä¸‹ç¦ç”¨ä¿å­˜æŒ‰é’®
					const saveButton = document.getElementById('save-settings');
					saveButton.disabled = true;
				}, 100);
			});

			function applyFont(v){
				document.documentElement.style.setProperty('--font-size', v + 'px');
			}
			
			function applyAnim(v){
				if (typeof window.setAnimationSpeed === 'function') {
					window.setAnimationSpeed(Number(v));
				} else {
					document.documentElement.style.setProperty('--transition-duration', v + 'ms');
					localStorage.setItem('animationSpeed', String(v));
				}
			}
		});
	</script>
</body>
</html>