<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../styles/main.css">
<link rel="stylesheet" href="../styles/accounts.css">
<title>Accounts - Electronic</title>
</head>
<body class="page-fade-in">
	<div class="nav" id="nav">
		<img src="../res/Electronic Logo.png" alt="Electronic Logo" class="logo" onclick="toNewWindow('http:/8.138.227.135')">
		<div class="nav-buttons">
			<button type="button" class="nav-btn" data-text="Basic Info" data-href="./main.html" data-theme-action="restore">âšª<span>Basic</span></button>
			<button type="button" class="nav-btn active" data-text="Accounts" data-href="./accounts.html" data-theme-action="restore">ğŸ‘¥<span>Accounts</span></button>
			<button type="button" class="nav-btn" data-text="Settings" data-href="./settings.html" data-theme-action="save">âš™ï¸<span>Settings</span></button>
		</div>
		<button type="button" class="toggle-nav" id="toggleNav">å±•å¼€</button>
	</div>

	<div class="labels" id="labels">
		<button class="labelsButton active" data-category="accounts-overview">æ¦‚è§ˆ</button>
		<button class="labelsButton" data-category="accounts-list">åˆ—è¡¨</button>
	</div>

	<div class="content-panel accounts-overview-panel" id="accounts-overview-panel">
		<h2>Accounts æ¦‚è§ˆ</h2>
		<p>ç®€å•çš„è´¦æˆ·ç»Ÿè®¡ç¤ºä¾‹ã€‚</p>
		<div class="info-grid">
			<div class="info-card"><h3>æ€»ç”¨æˆ·</h3><p id="totalUsers">1,234</p></div>
			<div class="info-card"><h3>åœ¨çº¿ç”¨æˆ·</h3><p id="onlineUsers">123</p></div>
		</div>
	</div>

	<div class="content-panel accounts-list-panel" id="accounts-list-panel">
		<h2>è´¦æˆ·åˆ—è¡¨</h2>

		<div class="account-search-container">
			<input id="accountSearch" placeholder="æœç´¢ç”¨æˆ·å..." class="account-search-input">
			<button id="addAccountBtn" class="settings-btn">æ·»åŠ è´¦æˆ·</button>
			<div class="pagination-container"> <!-- åˆ†é¡µå ä½ -->
				<span id="paginationInfo">1-10 / <span id="totalCount">3</span></span>
			</div>
		</div>

		<table class="device-table" id="accountsTable">
			<thead><tr><th>ç”¨æˆ·å</th><th>è§’è‰²</th><th>çŠ¶æ€</th><th>æ“ä½œ</th></tr></thead>
			<tbody>
				<tr data-id="1"><td>alice</td><td>admin</td><td><span class="status online">åœ¨çº¿</span></td><td><button class="edit-btn settings-btn">ç¼–è¾‘</button> <button class="delete-btn">åˆ é™¤</button></td></tr>
				<tr data-id="2"><td>bob</td><td>user</td><td><span class="status offline">ç¦»çº¿</span></td><td><button class="edit-btn settings-btn">ç¼–è¾‘</button> <button class="delete-btn">åˆ é™¤</button></td></tr>
				<tr data-id="3"><td>charlie</td><td>user</td><td><span class="status warning">è­¦å‘Š</span></td><td><button class="edit-btn settings-btn">ç¼–è¾‘</button> <button class="delete-btn">åˆ é™¤</button></td></tr>
			</tbody>
		</table>
	</div>

	<!-- ç¼–è¾‘ / æ·»åŠ  æ¨¡æ€ -->
	<div id="accountModal" class="account-modal">
		<div class="account-modal-content">
			<h3 id="modalTitle">ç¼–è¾‘è´¦æˆ·</h3>
			<div class="account-modal-form">
				<input id="modalUsername" placeholder="ç”¨æˆ·å" class="account-modal-input">
				<select id="modalRole" class="account-modal-select" title="è§’è‰²" data-custom>
					<option value="admin">admin</option>
					<option value="user">user</option>
				</select>
				<select id="modalStatus" class="account-modal-select" title="çŠ¶æ€" data-custom>
					<option value="online">åœ¨çº¿</option>
					<option value="offline">ç¦»çº¿</option>
					<option value="warning">è­¦å‘Š</option>
				</select>
				<div class="account-modal-buttons">
					<button id="modalCancel" class="settings-btn">å–æ¶ˆ</button>
					<button id="modalSave" class="settings-btn account-modal-save-btn">ä¿å­˜</button>
				</div>
			</div>
		</div>
	</div>

	<!-- å…¼å®¹æ—§é¡µé¢çš„å…¨å±€ APIï¼ˆå®šä¹‰åœ¨ main.js ä¹‹å‰ï¼Œé˜»æ­¢ wrapper è¦†ç›–ï¼‰ -->
	<script>
		// ä¿æŒå‡½æ•°å­˜åœ¨ä½†åœ¨è°ƒç”¨æ—¶ä¼˜å…ˆä½¿ç”¨ navigateWithFadeï¼ˆè‹¥å¯ç”¨ï¼‰
		function toOriWindow(href) {
			if (typeof navigateWithFade === 'function') return navigateWithFade(href, 'restore');
			window.location.href = href;
		}
		function toNewWindow(href) {
			try { window.open(href, '_blank', 'noopener'); } catch(e) { window.location.href = href; }
		}
		function saveCurrentTheme() {
			try { localStorage.setItem('savedThemeClass', document.documentElement.className || ''); showNotification && showNotification('ä¸»é¢˜å·²ä¿å­˜','success'); } catch(e) {}
		}
		function restoreOriginalTheme() {
			try { const cls = localStorage.getItem('savedThemeClass'); if (cls!==null) document.documentElement.className = cls; showNotification && showNotification('å·²æ¢å¤ä¸»é¢˜','success'); } catch(e) {}
		}
		function showNotification(msg, type) {
			// æ£€æŸ¥é€šçŸ¥æ˜¯å¦å¯ç”¨
			const notificationsEnabled = localStorage.getItem('notificationsEnabled') !== 'false';
			if (!notificationsEnabled) {
				return; // å¦‚æœé€šçŸ¥è¢«ç¦ç”¨ï¼Œç›´æ¥è¿”å›ä¸æ˜¾ç¤ºé€šçŸ¥
			}
			// type: 'info'|'warning'|'error'|'success'
			const map = { error:'error', warning:'warning', info:'info', success:'info' };
			const id = map[type] || 'info';
			const el = document.getElementById(id) || document.querySelector('.' + id);
			if (!el) return;
			const content = el.querySelector('.' + id + '-content') || el;
			if (content) content.textContent = msg;
			el.classList.add('show');
			setTimeout(()=>el.classList.remove('show'), 4000);
		}
		function hideError(){ const e=document.getElementById('error'); e && e.classList.remove('show'); }
		function hideWarning(){ const e=document.getElementById('warning'); e && e.classList.remove('show'); }
		function hideInfo(){ const e=document.getElementById('info'); e && e.classList.remove('show'); }
	</script>

	<script src="../scripts/base.js"></script>
	<script src="../scripts/settings-global.js"></script>
	<script src="../scripts/notification.js"></script>
	<script src="../scripts/notification.js"></script>
	<script src="../scripts/custom-select.js"></script>

	<!-- æœ¬é¡µäº¤äº’ï¼šæ·»åŠ /ç¼–è¾‘/åˆ é™¤/æœç´¢ï¼ˆå†…è”å®ç°ï¼Œè½»é‡ï¼‰ -->
	<script>
	(function(){
		const table = document.getElementById('accountsTable').querySelector('tbody');
		const modal = document.getElementById('accountModal');
		const modalTitle = document.getElementById('modalTitle');
		let editRow = null;

		document.getElementById('addAccountBtn').addEventListener('click', ()=> {
			editRow = null;
			modalTitle.textContent = 'æ·»åŠ è´¦æˆ·';
			document.getElementById('modalUsername').value = '';
			document.getElementById('modalRole').value = 'user';
			document.getElementById('modalStatus').value = 'online';
			// è§¦å‘åŠ¨ç”»çš„æ­£ç¡®æ–¹å¼
			requestAnimationFrame(() => {
				modal.classList.add('show');
			});
		});
		document.getElementById('modalCancel').addEventListener('click', ()=> {
			modal.classList.remove('show');
		});

		document.getElementById('modalSave').addEventListener('click', ()=> {
			const name = document.getElementById('modalUsername').value.trim();
			const role = document.getElementById('modalRole').value;
			const status = document.getElementById('modalStatus').value;
			if (!name) { showNotification && showNotification('ç”¨æˆ·åä¸èƒ½ä¸ºç©º','warning'); return; }

			if (editRow) {
				editRow.querySelector('td:nth-child(1)').textContent = name;
				editRow.querySelector('td:nth-child(2)').textContent = role;
				const statusEl = editRow.querySelector('td:nth-child(3) .status');
				statusEl.className = 'status ' + status;
				statusEl.textContent = status === 'online' ? 'åœ¨çº¿' : status === 'offline' ? 'ç¦»çº¿' : 'è­¦å‘Š';
				showNotification && showNotification('å·²æ›´æ–°è´¦æˆ·','success');
			} else {
				const tr = document.createElement('tr');
				const id = Date.now();
				tr.setAttribute('data-id', id);
				tr.innerHTML = `<td>${escapeHtml(name)}</td><td>${escapeHtml(role)}</td><td><span class="status ${status}">${status==='online'?'åœ¨çº¿':status==='offline'?'ç¦»çº¿':'è­¦å‘Š'}</span></td><td><button class="edit-btn settings-btn">ç¼–è¾‘</button> <button class="delete-btn">åˆ é™¤</button></td>`;
				table.appendChild(tr);
				showNotification && showNotification('æ·»åŠ æˆåŠŸ','success');
			}
			modal.classList.remove('show');
			updateBindings();
		});

		function updateBindings(){
			table.querySelectorAll('.edit-btn').forEach(btn=>{
				btn.onclick = (e)=>{
					const tr = e.target.closest('tr');
					editRow = tr;
					modalTitle.textContent = 'ç¼–è¾‘è´¦æˆ·';
					document.getElementById('modalUsername').value = tr.children[0].textContent;
					document.getElementById('modalRole').value = tr.children[1].textContent;
					const st = tr.querySelector('.status').classList.contains('online') ? 'online' : tr.querySelector('.status').classList.contains('offline') ? 'offline' : 'warning';
					document.getElementById('modalStatus').value = st;
					// è§¦å‘åŠ¨ç”»çš„æ­£ç¡®æ–¹å¼
					requestAnimationFrame(() => {
						modal.classList.add('show');
					});
				};
			});
			table.querySelectorAll('.delete-btn').forEach(btn=>{
				btn.onclick = (e)=>{
					const tr = e.target.closest('tr');
					if (confirm('ç¡®å®šåˆ é™¤è¯¥è´¦æˆ·ï¼Ÿ')) {
						tr.remove();
						showNotification && showNotification('å·²åˆ é™¤','info');
					}
				};
			});
		}
		function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>'&#'+c.charCodeAt(0)+';'); }
		// æœç´¢
		document.getElementById('accountSearch').addEventListener('input', function(){
			const q = this.value.trim().toLowerCase();
			table.querySelectorAll('tr').forEach(tr=>{
				const txt = tr.children[0].textContent.toLowerCase();
				tr.style.display = txt.includes(q) ? '' : 'none';
			});
		});
		updateBindings();
	})();
	</script>
</body>
</html>